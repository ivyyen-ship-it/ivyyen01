<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå–®ç®¡ç†ä¸­å¿ƒ - å°ˆæ¥­é›»éŠ·ç³»çµ±ä»‹é¢</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* è¨­å®šé è¨­å­—é«”ç‚º Inter å’Œç³»çµ±ä¸­æ–‡å­—é«” */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #F9FAFB; /* ç°ç™½è‰²èƒŒæ™¯ */
            color: #1F2937; /* æ·±ç°è‰²æ–‡å­— */
        }
        .primary-purple {
            background-color: #6B46C1; /* ä¸»ç´«è‰² */
        }
        .primary-purple-text {
            color: #6B46C1;
        }
        .card {
            background-color: white;
            border-radius: 1rem; /* å¤§åœ“è§’ */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* æŸ”å’Œé™°å½± */
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.15);
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        /* Custom styles for status colors */
        .status-ä½‡åˆ—ä¸­ { background-color: #3B82F6; color: white; } /* è—è‰² (ä½‡åˆ—ä¸­) */
        .status-ç”¨é¤ä¸­ { background-color: #FBBF24; color: #1F2937; } /* é»ƒè‰² */
        .status-æœƒè­°ä¸­ { background-color: #10B981; color: white; } /* ç¶ è‰² */
        .status-é›¢é–‹ { background-color: #EF4444; color: white; } /* ç´…è‰² */

        /* Animation for the alert card */
        @keyframes pulse-light {
            0%, 100% { background-color: #FFFBEB; }
            50% { background-color: #FEF3C7; }
        }
        .alert-card-pulse {
            animation: pulse-light 2s infinite ease-in-out;
        }

        /* æˆ°æƒ…çœ‹æ¿åˆ†é æŒ‰éˆ•æ¨£å¼ */
        .dept-tab {
            text-align: center;
        }
        .dept-tab.active {
            background-color: #6B46C1; /* ä¸»ç´«è‰² */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(107, 70, 193, 0.3); /* ç´«è‰²é™°å½± */
        }
        /* Loading spinner styles */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #6B46C1;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- é ‚éƒ¨å°è¦½åˆ— -->
    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <h1 class="text-2xl font-bold primary-purple-text">åå–®ç®¡ç†ä¸­å¿ƒ</h1>
                <span class="text-sm text-gray-500 hidden sm:block">ä½¿ç”¨è€…ï¼š**ç‹å°æ˜** (å°ˆæ¥­é›»éŠ·ä¸»ç®¡)</span>
            </div>
            <div class="flex items-center space-x-4">
                <!-- å¾Œå°ç·¨è¼¯æŒ‰éˆ• (äº®ç´«è‰²/è—ç°è‰²) -->
                <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-lg transition duration-150 ease-in-out transform hover:scale-105 border-b-4 border-indigo-800 active:border-b-2 active:translate-y-0.5">
                    å¾Œå°ç·¨è¼¯
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

        <!-- ç‹€æ…‹é¸æ“‡èˆ‡è¨ˆæ™‚å™¨å€å¡Š -->
        <div class="bg-white p-4 sm:p-6 card mb-6 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0 md:space-x-6">
            <div class="flex items-center space-x-3 w-full md:w-auto">
                <label for="status-select" class="text-lg font-semibold text-gray-700 whitespace-nowrap">æˆ‘çš„ç‹€æ…‹:</label>
                <select id="status-select" class="form-select block w-full md:w-48 p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm bg-gray-50 text-base">
                    <option value="ä½‡åˆ—ä¸­">ä½‡åˆ—ä¸­</option>
                    <option value="ç”¨é¤ä¸­">ç”¨é¤ä¸­</option>
                    <option value="æœƒè­°ä¸­">æœƒè­°ä¸­</option>
                    <option value="é›¢é–‹">é›¢é–‹</option>
                </select>
            </div>
            <!-- ç•¶æ—¥ç‹€æ…‹ç´¯ç©æ™‚é–“é¡¯ç¤º -->
            <div class="flex flex-wrap gap-x-6 gap-y-2 text-sm font-medium w-full md:w-auto">
                <div class="flex items-center space-x-1">
                    <span class="status-badge status-ä½‡åˆ—ä¸­">ä½‡åˆ—ä¸­</span>
                    <span id="time-ä½‡åˆ—ä¸­" class="text-gray-700">00:00</span>
                </div>
                <div class="flex items-center space-x-1">
                    <span class="status-badge status-ç”¨é¤ä¸­">ç”¨é¤ä¸­</span>
                    <span id="time-ç”¨é¤ä¸­" class="text-gray-700">00:00</span>
                </div>
                <div class="flex items-center space-x-1">
                    <span class="status-badge status-æœƒè­°ä¸­">æœƒè­°ä¸­</span>
                    <span id="time-æœƒè­°ä¸­" class="text-gray-700">00:00</span>
                </div>
                <div class="flex items-center space-x-1">
                    <span class="status-badge status-é›¢é–‹">é›¢é–‹</span>
                    <span id="time-é›¢é–‹" class="text-gray-700">00:00</span>
                </div>
            </div>
        </div>

        <!-- è¿½è¹¤æé†’å€å¡Š -->
        <div id="reminder-alert" class="card p-4 mb-6 alert-card-pulse border-l-4 border-yellow-500">
            <h2 class="text-xl font-bold text-yellow-800 mb-2">ğŸš¨ å³å°‡åˆ°è¿½è¹¤æ™‚é–“çš„åå–®æé†’ (1)</h2>
            <ul class="list-disc ml-5 text-lg text-yellow-700">
                <li class="font-semibold">åå–®åç¨±: é™³å°å§ (A-1021) - å€’æ•¸æ™‚é–“: <span class="font-mono text-red-600">01:35</span> åˆ†é˜</li>
                <!-- æ›´å¤šæé†’åå–®... -->
            </ul>
        </div>

        <!-- æˆ°æƒ…çœ‹æ¿ (Dashboard) -->
        <section class="mb-6">
            <h2 class="text-2xl font-bold primary-purple-text mb-4">ğŸ“ˆ æˆ°æƒ…çœ‹æ¿ - <span id="current-dept-title">é›»éŠ·</span>éƒ¨é–€ç¸¾æ•ˆ</h2>

            <!-- éƒ¨é–€åˆ‡æ›æ¨™ç±¤ -->
            <div class="flex space-x-2 mb-6 p-1 bg-gray-200 rounded-xl shadow-inner max-w-xl">
                <button data-dept="é›»éŠ·" class="dept-tab active w-1/4 text-sm font-semibold py-2 px-4 rounded-xl transition duration-150 ease-in-out">é›»éŠ·</button>
                <button data-dept="å®¢æœ" class="dept-tab w-1/4 text-sm font-semibold text-gray-700 hover:bg-white py-2 px-4 rounded-xl transition duration-150 ease-in-out">å®¢æœ</button>
                <button data-dept="ç‡Ÿç®¡" class="dept-tab w-1/4 text-sm font-semibold text-gray-700 hover:bg-white py-2 px-4 rounded-xl transition duration-150 ease-in-out">ç‡Ÿç®¡</button>
                <button data-dept="é›»å•†" class="dept-tab w-1/4 text-sm font-semibold text-gray-700 hover:bg-white py-2 px-4 rounded-xl transition duration-150 ease-in-out">é›»å•†</button>
            </div>

            <!-- å„€éŒ¶æ¿æ•¸æ“š -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4" id="dashboard-data">
                
                <!-- éƒ¨é–€ç‡Ÿé‹æŒ‡æ¨™ (ä¸Šå±¤) - ç¶­æŒå››é …æŒ‡æ¨™ï¼Œæ¯åˆ—å››å€‹ -->
                <div class="card p-4 text-center bg-purple-50 hover:bg-purple-100 cursor-pointer">
                    <p class="text-sm text-gray-600">éƒ¨é–€å¾…è™•ç†åå–®</p>
                    <p id="dept-pending" class="text-3xl font-extrabold primary-purple-text">125</p>
                </div>
                <div class="card p-4 text-center bg-purple-50 hover:bg-purple-100 cursor-pointer">
                    <p class="text-sm text-gray-600">éƒ¨é–€è™•ç†ä¸­åå–®</p>
                    <p id="dept-in-progress" class="text-3xl font-extrabold primary-purple-text">88</p>
                </div>
                <div class="card p-4 text-center bg-purple-50 hover:bg-purple-100 cursor-pointer">
                    <p class="text-sm text-gray-600">éƒ¨é–€ç•¶æ—¥å·²ç· çµ</p>
                    <p id="dept-closed-day" class="text-3xl font-extrabold text-green-600">5</p>
                </div>
                
                <!-- éƒ¨é–€ç•¶æœˆç· çµç‡ -->
                <div class="card p-4 text-center bg-purple-50 hover:bg-purple-100 cursor-pointer">
                    <p class="text-sm text-gray-600">éƒ¨é–€ç•¶æœˆç· çµç‡</p>
                    <p id="dept-closure-rate" class="text-3xl font-extrabold text-indigo-600">10.5%</p>
                </div>


                <!-- å€‹äººç¸¾æ•ˆ (ä¸‹å±¤ï¼Œç¶­æŒå››é …) -->
                <div class="card p-4 text-center bg-gray-100 hover:bg-gray-200">
                    <p class="text-sm text-gray-600">å€‹äººå¾…è™•ç†åå–®</p>
                    <p class="text-3xl font-extrabold text-gray-800">18</p>
                </div>
                <div class="card p-4 text-center bg-gray-100 hover:bg-gray-200">
                    <p class="text-sm text-gray-600">å€‹äººè™•ç†ä¸­åå–®</p>
                    <p class="text-3xl font-extrabold text-gray-800">12</p>
                </div>
                <div class="card p-4 text-center bg-gray-100 hover:bg-gray-200">
                    <p class="text-sm text-gray-600">å€‹äººç•¶æ—¥å·²ç· çµ</p>
                    <p class="text-3xl font-extrabold text-green-600">2</p>
                </div>
                <div class="card p-4 text-center bg-gray-100 hover:bg-gray-200">
                    <p class="text-sm text-gray-600">ç•¶æœˆå€‹äººç· çµç‡</p>
                    <p class="text-3xl font-extrabold text-indigo-600">15.4%</p>
                </div>
            </div>
        </section>


        <!-- å€‹äººè² è²¬åå–® & å³å´åŠŸèƒ½å€ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- å·¦å´ï¼šå€‹äººè² è²¬åå–® (åˆ†é¡ç®¡ç†) - ä½” 2/3 å¯¬åº¦ -->
            <section class="lg:col-span-2 space-y-6">
                <h2 class="text-2xl font-bold primary-purple-text">ğŸ“‹ å€‹äººè² è²¬åå–® (åˆ†é¡ç®¡ç†)</h2>

                <!-- å¡ç‰‡ 1: æœªè™•ç†åå–® -->
                <div class="card p-6 border-l-4 border-red-500">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-red-700">æœªè™•ç†åå–® (18 ç­†)</h3>
                        <a href="#" class="text-sm text-red-500 hover:text-red-600 font-medium">æŸ¥çœ‹å…¨éƒ¨ &rarr;</a>
                    </div>
                    <ul class="space-y-3 text-gray-600">
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100">
                            <span>å¼µå…ˆç”Ÿ (B-2001)</span>
                            <span class="text-xs text-red-500 font-semibold">å¾…åˆ†æ´¾ / 3 å¤©å‰</span>
                        </li>
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100">
                            <span>æ—å°å§ (B-2002)</span>
                            <span class="text-xs text-red-500 font-semibold">å¾…åˆ†æ´¾ / 2 å¤©å‰</span>
                        </li>
                        <li class="text-center text-sm text-gray-400">... é‚„æœ‰ 16 ç­†æœªè™•ç† ...</li>
                    </ul>
                </div>

                <!-- å¡ç‰‡ 2: ç•¶æ—¥éœ€è¿½è¹¤åå–®ï¼ˆè¿½è¹¤è­¦ç¤ºï¼‰ -->
                <div class="card p-6 border-l-4 border-yellow-500 bg-yellow-50">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-yellow-700">â° ç•¶æ—¥éœ€è¿½è¹¤åå–® (3 ç­†)</h3>
                        <a href="#" class="text-sm text-yellow-500 hover:text-yellow-600 font-medium">æŸ¥çœ‹è­¦ç¤º &rarr;</a>
                    </div>
                    <ul class="space-y-3 text-gray-600">
                        <li class="flex justify-between items-center p-3 bg-white rounded-lg border border-yellow-200 shadow-sm">
                            <span>ç‹å…ˆç”Ÿ (C-3005)</span>
                            <span class="text-xs text-yellow-600 font-semibold">é è¨ˆè¿½è¹¤: 10:30 AM</span>
                        </li>
                        <li class="flex justify-between items-center p-3 bg-white rounded-lg border border-yellow-200 shadow-sm">
                            <span>å³å°å§ (C-3006)</span>
                            <span class="text-xs text-yellow-600 font-semibold">é è¨ˆè¿½è¹¤: 02:00 PM</span>
                        </li>
                    </ul>
                </div>

                <!-- å¡ç‰‡ 3: å…¶ä»–è¿½è¹¤åå–®ï¼ˆæœªä¾†ï¼ä¸€èˆ¬åå–®ï¼‰ -->
                <div class="card p-6 border-l-4 border-indigo-500">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-indigo-700">å…¶ä»–è¿½è¹¤åå–® (98 ç­†)</h3>
                        <a href="#" class="text-sm text-indigo-500 hover:text-indigo-600 font-medium">æŸ¥çœ‹æ¸…å–® &rarr;</a>
                    </div>
                    <ul class="space-y-3 text-gray-600">
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100">
                            <span>æå°å§ (D-4011)</span>
                            <span class="text-xs text-indigo-500">ä¸‹æ¬¡è¿½è¹¤: 2024/12/15</span>
                        </li>
                        <li class="flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100">
                            <span>æœ±å…ˆç”Ÿ (D-4012)</span>
                            <span class="text-xs text-indigo-500">ä¸‹æ¬¡è¿½è¹¤: 2024/12/20</span>
                        </li>
                        <li class="text-center text-sm text-gray-400">... é‚„æœ‰ 96 ç­† ...</li>
                    </ul>
                </div>
            </section>

            <!-- å³å´ï¼šåå–®ç¯©é¸å™¨èˆ‡æé†’å€å¡Š - ä½” 1/3 å¯¬åº¦ -->
            <aside class="lg:col-span-1 space-y-6">
                
                <!-- åå–®ç¯©é¸å™¨ -->
                <div class="card p-6 bg-gray-100">
                    <h3 class="text-xl font-semibold primary-purple-text mb-4">ğŸ” åå–®ç¯©é¸å™¨</h3>
                    <div class="space-y-4">
                        <!-- è¿½è¹¤æ™‚é–“ç¯©é¸ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">è¿½è¹¤æ™‚é–“</label>
                            <input type="date" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <!-- çµå–®å€é–“ (å·²ç´„å·¥/æœªç”³è£) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">çµå–®å€é–“ (å·²ç´„å·¥/æœªç”³è£)</label>
                            <div class="flex space-x-2">
                                <input type="date" class="w-1/2 p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                <input type="date" class="w-1/2 p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                        <!-- åå–®ç‹€æ…‹ç¯©é¸ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">åå–®ç‹€æ…‹</label>
                            <select class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                <option>æ‰€æœ‰åå–®</option>
                                <option>é«˜æ½›åŠ›</option>
                                <option>éœ€åŠ å¼·è¯ç¹«</option>
                            </select>
                        </div>
                        <button class="w-full primary-purple hover:bg-indigo-700 text-white font-semibold py-2 rounded-lg transition duration-150">
                            åŸ·è¡Œç¯©é¸
                        </button>
                    </div>
                </div>

                <!-- NEW: AI éŠ·å”®åŠ©ç†å€å¡Š -->
                <div class="card p-6 border-l-4 border-fuchsia-500">
                    <h3 class="text-xl font-semibold text-fuchsia-700 mb-4">ğŸ¤– AI éŠ·å”®åŠ©ç†</h3>
                    <div class="space-y-4">
                        <!-- åŠ©ç†è¼¸å…¥æ¡† -->
                        <div>
                            <label for="ai-prompt" class="block text-sm font-medium text-gray-700 mb-1">è¼¸å…¥éœ€æ±‚ (e.g. çµ¦æˆ‘è·Ÿé€²å¼µå…ˆç”Ÿçš„é–‹å ´ç™½)</label>
                            <textarea id="ai-prompt" rows="3" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 shadow-sm" placeholder="è¼¸å…¥åå–®è³‡è¨Šå’Œæ‚¨çš„éœ€æ±‚..."></textarea>
                        </div>
                        <!-- æŒ‰éˆ• -->
                        <button id="generate-script-btn" class="w-full bg-fuchsia-600 hover:bg-fuchsia-700 text-white font-semibold py-2 rounded-lg transition duration-150 flex items-center justify-center space-x-2">
                            <span id="button-text">ç”ŸæˆéŠ·å”®è…³æœ¬/æ‘˜è¦</span>
                            <div id="loading-spinner" class="spinner hidden"></div>
                        </button>
                        <!-- çµæœé¡¯ç¤º -->
                        <div id="ai-result-box" class="mt-4 p-3 bg-fuchsia-50 border border-fuchsia-200 rounded-lg min-h-[5rem] text-sm text-fuchsia-800 break-words whitespace-pre-wrap">
                            <p class="text-gray-500 italic">AI ç”Ÿæˆçš„å…§å®¹å°‡é¡¯ç¤ºåœ¨æ­¤è™•ã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- é‡è¦äº‹é …æé†’ -->
                <div class="card p-6 border-l-4 border-pink-500">
                    <h3 class="text-xl font-semibold text-pink-700 mb-4">ğŸ”” é‡è¦äº‹é …æé†’</h3>
                    <div class="space-y-3">
                        <!-- éƒ¨é–€å…¬å‘Š -->
                        <div class="bg-pink-50 p-3 rounded-lg border border-pink-200">
                            <p class="text-sm font-medium text-pink-800">ğŸ“Œ éƒ¨é–€å…¬å‘Š: æœ¬é€±ç¸¾æ•ˆç«¶è³½é–‹å§‹ï¼Œè«‹åŒä»åŠ æ²¹ï¼</p>
                            <span class="text-xs text-pink-500 block mt-1">ç™¼ä½ˆæ–¼ 1 å°æ™‚å‰</span>
                        </div>
                        <!-- å€‹äººæé†’ -->
                        <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <p class="text-sm font-medium text-gray-700">ğŸ‘¤ å€‹äººæé†’: å¾…è™•ç†åå–®å·²ç´¯ç© 18 ç­†ï¼Œè«‹å„ªå…ˆè™•ç†ã€‚</p>
                            <span class="text-xs text-gray-400 block mt-1">ç³»çµ±æç¤º</span>
                        </div>
                        <!-- æœƒè­°æé†’ -->
                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                            <p class="text-sm font-medium text-blue-800">ğŸ“… æœƒè­°æé†’: æ¯é€±ä¸»ç®¡ä¾‹æœƒ @ 14:00 (æœƒè­°å®¤ A)</p>
                            <span class="text-xs text-blue-500 block mt-1">æ™‚é–“: 30 åˆ†é˜å¾Œ</span>
                        </div>
                    </div>
                </div>

                <!-- å³å°‡åˆ°æœŸè­¦ç¤º (ç¨ç«‹å€å¡Š) -->
                <div class="card p-6 border-l-4 border-orange-500 bg-orange-50">
                    <h3 class="text-xl font-semibold text-orange-700 mb-3">âš ï¸ å³å°‡åˆ°æœŸè­¦ç¤º (2 ç­†)</h3>
                    <ul class="space-y-2 text-sm text-orange-800">
                        <li>æ½›åŠ›åå–® A-01: <span class="font-semibold">å‰©é¤˜ 4 å°æ™‚</span> (åå–®æœŸé™)</li>
                        <li>é«˜åƒ¹å€¼åå–® B-05: <span class="font-semibold">å‰©é¤˜ 1 å¤©</span> (å„ªæƒ æ´»å‹•åˆ°æœŸ)</li>
                    </ul>
                </div>
            </aside>
        </div>
    </main>

    <script>
        // JavaScript é‚è¼¯ï¼šè™•ç†ä½¿ç”¨è€…ç‹€æ…‹åˆ‡æ›èˆ‡è¨ˆæ™‚å™¨

        // ç‹€æ…‹è¨ˆæ™‚å™¨ç‰©ä»¶ (å–®ä½ï¼šç§’)
        const statusTimes = {
            'ä½‡åˆ—ä¸­': 0, // ä¿®æ­£å¾Œçš„ç‹€æ…‹åç¨±
            'ç”¨é¤ä¸­': 0,
            'æœƒè­°ä¸­': 0,
            'é›¢é–‹': 0
        };

        let currentStatus = 'ä½‡åˆ—ä¸­'; // ä¿®æ­£åˆå§‹ç‹€æ…‹
        let startTime = Date.now();
        let timerInterval;

        const statusSelect = document.getElementById('status-select');

        // æ ¼å¼åŒ–æ™‚é–“ï¼šç§’æ•¸è½‰æ›ç‚º MM:SS æ ¼å¼
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        // æ›´æ–° UI ä¸Šçš„æ™‚é–“
        function updateTimeDisplay() {
            for (const status in statusTimes) {
                // ä½¿ç”¨ä¿®æ­£å¾Œçš„ ID æŸ¥æ‰¾å…ƒç´ 
                const timeElement = document.getElementById(`time-${status}`);
                if (timeElement) {
                    timeElement.textContent = formatTime(statusTimes[status]);
                }
            }
        }

        // è¨ˆæ™‚å™¨ä¸»é‚è¼¯
        function startTimer() {
            // æ¸…é™¤ç¾æœ‰è¨ˆæ™‚å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            timerInterval = setInterval(() => {
                // æ¯ç§’æª¢æŸ¥ä¸€æ¬¡
                if (currentStatus in statusTimes) {
                    statusTimes[currentStatus]++; // ç•¶å‰ç‹€æ…‹ç§’æ•¸ +1
                    updateTimeDisplay();
                }
            }, 1000); // 1000 æ¯«ç§’ = 1 ç§’
        }

        // è™•ç†ç‹€æ…‹åˆ‡æ›äº‹ä»¶
        statusSelect.addEventListener('change', (event) => {
            currentStatus = event.target.value;
            // å¯ä»¥åŠ å…¥è¦–è¦ºå›é¥‹ï¼Œä¾‹å¦‚æ”¹è®Š select æ¡†çš„æ¨£å¼ï¼Œä½† Tailwind å·²ç¶“è™•ç†éƒ¨åˆ†
            console.log(`ç‹€æ…‹åˆ‡æ›ç‚º: ${currentStatus}`);
        });

        // =========================================================
        // éƒ¨é–€åˆ‡æ›é‚è¼¯ (æ¨¡æ“¬æ•¸æ“šè¼‰å…¥)
        // =========================================================

        const deptTabs = document.querySelectorAll('.dept-tab');
        const currentDeptTitle = document.getElementById('current-dept-title');
        
        // æ¨¡æ“¬ä¸åŒéƒ¨é–€çš„éƒ¨é–€ç‡Ÿé‹æŒ‡æ¨™æ•¸æ“š
        const deptData = {
            'é›»éŠ·': {
                pending: 125, in_progress: 88, closed_day: 5, closure_rate: '10.5%'
            },
            'å®¢æœ': {
                pending: 250, in_progress: 15, closed_day: 10, closure_rate: '3.1%'
            },
            'ç‡Ÿç®¡': {
                pending: 30, in_progress: 5, closed_day: 0, closure_rate: '0.0%'
            },
            'é›»å•†': {
                pending: 99, in_progress: 50, closed_day: 8, closure_rate: '18.9%'
            }
        };

        function updateDashboard(department) {
            const data = deptData[department];
            if (!data) return;

            // æ›´æ–°éƒ¨é–€ç‡Ÿé‹æŒ‡æ¨™
            document.getElementById('dept-pending').textContent = data.pending;
            document.getElementById('dept-in-progress').textContent = data.in_progress;
            document.getElementById('dept-closed-day').textContent = data.closed_day;
            document.getElementById('dept-closure-rate').textContent = data.closure_rate;

            // æ›´æ–°æ¨™é¡Œ
            currentDeptTitle.textContent = department;
        }

        deptTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const selectedDept = tab.getAttribute('data-dept');
                
                // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active æ¨£å¼
                deptTabs.forEach(t => t.classList.remove('active'));
                
                // ç‚ºè¢«é»æ“Šçš„æŒ‰éˆ•åŠ ä¸Š active æ¨£å¼
                tab.classList.add('active');
                
                // æ¨¡æ“¬æ›´æ–°çœ‹æ¿æ•¸æ“š
                updateDashboard(selectedDept);

                console.log(`å·²åˆ‡æ›è‡³ ${selectedDept} éƒ¨é–€æˆ°æƒ…çœ‹æ¿`);
            });
        });


        // =========================================================
        // AI éŠ·å”®åŠ©ç† (Gemini API æ•´åˆ)
        // =========================================================
        const aiPromptTextarea = document.getElementById('ai-prompt');
        const generateScriptBtn = document.getElementById('generate-script-btn');
        const aiResultBox = document.getElementById('ai-result-box');
        const loadingSpinner = document.getElementById('loading-spinner');
        const buttonText = document.getElementById('button-text');

        // é€šç”¨ API å‘¼å«å‡½å¼ (å«æŒ‡æ•¸é€€é¿æ©Ÿåˆ¶)
        async function fetchWithBackoff(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            throw new Error("Maximum retries reached.");
        }

        // ç”Ÿæˆè…³æœ¬/æ‘˜è¦
        async function generateScript() {
            const userQuery = aiPromptTextarea.value.trim();
            if (!userQuery) {
                aiResultBox.innerHTML = '<p class="text-red-500">è«‹è¼¸å…¥æ‚¨çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šã€Œçµ¦æˆ‘è·Ÿé€²æå°å§ï¼ˆD-4011ï¼‰çš„é›»éŠ·è…³æœ¬ã€‚ã€</p>';
                return;
            }

            // UI ç‹€æ…‹ï¼šé¡¯ç¤ºè¼‰å…¥
            generateScriptBtn.disabled = true;
            loadingSpinner.classList.remove('hidden');
            buttonText.textContent = 'ç”Ÿæˆä¸­...';
            aiResultBox.innerHTML = '<div class="flex items-center space-x-2 text-fuchsia-600"><div class="spinner border-fuchsia-600 border-t-fuchsia-800"></div><span>AI æ­£åœ¨åˆ†æèˆ‡æ’°å¯«...</span></div>';


            const systemPrompt = "ä½ æ˜¯ä¸€ä½é ‚å°–çš„é›»éŠ·/å®¢æœå°ˆå®¶ï¼Œå°ˆé–€ç‚ºå°ç£çš„éŠ·å”®äººå“¡æ’°å¯«é«˜æ•ˆã€å°ˆæ¥­ä¸”å£èªåŒ–çš„éŠ·å”®è…³æœ¬æˆ–åå–®æ‘˜è¦ã€‚è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡ï¼Œä¸¦ä¿æŒç°¡æ½”ã€æœ‰åŠ›çš„èªæ°£ã€‚ç›´æ¥è¼¸å‡ºè…³æœ¬æˆ–æ‘˜è¦ï¼Œä¸éœ€è¦ä»»ä½•å‰è¨€æˆ–çµå°¾ã€‚";
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];

                let generatedText = "ç„¡æ³•å–å¾— AI å…§å®¹ã€‚";
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    generatedText = candidate.content.parts[0].text;
                } else if (result.error) {
                     generatedText = `API éŒ¯èª¤: ${result.error.message}`;
                }

                aiResultBox.textContent = generatedText;
                aiResultBox.classList.remove('text-gray-500', 'italic');
                
            } catch (error) {
                console.error("Gemini API Call Failed:", error);
                aiResultBox.textContent = `âŒ ç¶²è·¯æˆ– API ç™¼ç”ŸéŒ¯èª¤: ${error.message}`;
                aiResultBox.classList.remove('text-gray-500', 'italic');
                aiResultBox.classList.add('text-red-600');
            } finally {
                // UI ç‹€æ…‹ï¼šæ¢å¾©
                generateScriptBtn.disabled = false;
                loadingSpinner.classList.add('hidden');
                buttonText.textContent = 'ç”ŸæˆéŠ·å”®è…³æœ¬/æ‘˜è¦';
            }
        }

        // ç¶å®šäº‹ä»¶
        generateScriptBtn.addEventListener('click', generateScript);


        // =========================================================
        // åˆå§‹åŒ–
        // =========================================================
        window.onload = () => {
            // ç¢ºä¿ç•¶å‰ç‹€æ…‹èˆ‡ä¸‹æ‹‰é¸å–®çš„åˆå§‹å€¼ä¸€è‡´
            currentStatus = statusSelect.value;
            startTimer();
            // åˆå§‹åŒ–æˆ°æƒ…çœ‹æ¿ç‚ºã€Œé›»éŠ·ã€çš„æ•¸æ“š
            updateDashboard('é›»éŠ·');
        };

    </script>
</body>
</html>
